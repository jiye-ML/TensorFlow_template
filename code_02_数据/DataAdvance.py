'''Tensorflow高阶读写教程:    http://blog.csdn.net/u010223750/article/details/70482498'''# coding=utf-8import tensorflow as tfimport osimport numpy as np'''变长和定长数据操作tfrecords'''def study_variable_length():    keys = [[1.0], [], [2.0, 3.0]]    # keys = [[1.0, 2.0], [2.0, 3.0]]    with tf.Session() as sess:        sess.run(tf.global_variables_initializer())        # 制作一个 example        def make_example(key):            example = tf.train.Example(features=tf.train.Features(                feature={'ft': tf.train.Feature(float_list=tf.train.FloatList(value=key))}            ))            return example        filename = "tmp.tfrecords"        if os.path.exists(filename):            os.remove(filename)        writer = tf.python_io.TFRecordWriter(filename)        for key in keys:            ex = make_example(key)            writer.write(ex.SerializeToString())        writer.close()        reader = tf.TFRecordReader()        filename_queue = tf.train.string_input_producer(["tmp.tfrecords"], num_epochs=3)        _, serialized_example = reader.read(filename_queue)        coord = tf.train.Coordinator()        threads = tf.train.start_queue_runners(sess=sess, coord=coord)        batch = tf.train.batch(tensors=[serialized_example], batch_size=3)        # 变长数据        features = {"ft": tf.VarLenFeature(tf.float32)}        # key_parsed = tf.parse_single_example(make_example([1,2,3]).SerializeToString(),features)        key_parsed = tf.parse_example(batch, features)        # start the queue        print(tf.contrib.learn.run_n(key_parsed))        # []means scalar        # 定长度数据        # 可见，对于VarLenFeature，是能返回正常结果的，但是对于FixedLenFeature则返回size不对，可见如果对于边长的数据还是不要使用FixedLenFeature为好。        features = { "ft": tf.FixedLenFeature(shape=[2], dtype=tf.float32)}        key_parsed = tf.parse_example(batch, features)        print(tf.contrib.learn.run_n(key_parsed))